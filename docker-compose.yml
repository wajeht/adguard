services:
  adguard:
    image: adguard/adguardhome:v0.107.71
    container_name: adguard
    init: true # proper PID 1 signal handling and zombie reaping
    restart: unless-stopped
    depends_on:
      - unbound
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "3000:3000/tcp"  # Initial setup UI
      - "80:80/tcp"      # Web UI (after setup)
      - "443:443/tcp"    # HTTPS
    volumes:
      - ./data/work:/opt/adguardhome/work
      - ./data/conf:/opt/adguardhome/conf
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 256M
          pids: 200 # fork bomb protection
    networks:
      - adguard_net

  unbound:
    image: klutchell/unbound:1.24.2
    container_name: unbound
    init: true # proper PID 1 signal handling and zombie reaping
    restart: unless-stopped
    volumes:
      - ./unbound:/etc/unbound/custom.conf.d:ro
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 128M
          pids: 100 # fork bomb protection
    networks:
      - adguard_net

networks:
  adguard_net:
    driver: bridge
