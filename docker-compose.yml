services:
  adguard:
    image: adguard/adguardhome:v0.107.71@sha256:92929135ced2554aaf94706f766a98ad348f211df61b0704e2db7e8498cc00b7
    container_name: adguard
    restart: unless-stopped
    depends_on:
      - unbound
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "3000:3000/tcp"  # Initial setup UI
      - "80:80/tcp"      # Web UI (after setup)
      - "443:443/tcp"    # HTTPS
    volumes:
      - ./data/work:/opt/adguardhome/work
      - ./data/conf:/opt/adguardhome/conf
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 256M
    networks:
      - adguard_net

  unbound:
    image: klutchell/unbound:1.24.2@sha256:cb9a0f06c803c764395e2ff50bd8a244470601290c78fb2cdcf1bd200a027cd6
    container_name: unbound
    restart: unless-stopped
    volumes:
      - ./unbound:/etc/unbound/custom.conf.d:ro
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 128M
    networks:
      - adguard_net

networks:
  adguard_net:
    driver: bridge
